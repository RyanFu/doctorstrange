{
    "version": 3,
    "sources": [
        "../../../src/home/controller/login.js"
    ],
    "names": [],
    "mappings": "AAAA;;;;;;;;;;;;;;;;;;;;;;;;AAEA;;;;AACA;;;;;;;;;;;;;;AAGE;;;;mBAIM,W;;;;;;;;qBACgB,KAAK,OAAL,E;;;AAAhB,qB;;mBAEA,O;;;;;+CACK,KAAK,QAAL,CAAc,GAAd,C;;;+CAGF,KAAK,OAAL,CAAa,KAAK,YAAlB,C;;;;;;;;;;;;;;;;;mBAGH,W;;;;;;;;qBACgB,KAAK,OAAL,E;;;AAAhB,qB;;kBACC,O;;;;;AACC,sB,GAAW,KAAK,IAAL,CAAU,UAAV,C;AACX,sB,GAAW,KAAK,IAAL,CAAU,UAAV,C;AACX,sB,GAAW,sBAAW,QAAX,CAAoB;AACjC,0BAAU,QADuB;AAEjC,0BAAU;AAFuB,eAApB,EAGZ;AACD,4BAAY;AACV,4BAAU;AACR,8BAAU,IADF;AAER,6BAAS,gBAFD;AAGR,0BAAM,QAHE;AAIR,iCAAa;AAJL,mBADA;AAOV,4BAAU;AACR,8BAAU,IADF;AAER,6BAAS,cAFD;AAGR,0BAAM,QAHE;AAIR,iCAAa;AAJL;AAPA;AADX,eAHY,C;;kBAoBV,SAAS,K;;;;;gDACL,KAAK,IAAL,CAAU,gBAAV,C;;;AAGL,gB,GAAK,KAAK,EAAL,E;;qBACU,KAAK,KAAL,CAAW,MAAX,EAAmB,KAAnB,CAAyB,QAAzB,EAAmC,QAAnC,EAA6C,EAA7C,C;;;AAAf,oB;;oBAEA,OAAO,MAAP,KAAkB,Q;;;;;gDACb,KAAK,IAAL,CAAU,OAAO,MAAP,CAAV,C;;;;qBAGH,KAAK,OAAL,CAAa,UAAb,EAAyB,MAAzB,C;;;AACJ,mBAAK,OAAL,CAAa;AACX,wBAAQ;AADG,eAAb;;;;;AAKA,mBAAK,OAAL,CAAa;AACX,wBAAQ;AADG,eAAb;;;;;;;;;;;;;;;;;mBAMA,Y;;;;;;;;qBACgB,KAAK,OAAL,E;;;AAAhB,qB;;mBAEA,O;;;;;;qBACI,KAAK,OAAL,CAAa,UAAb,EAAyB,IAAzB,C;;;;AAEN,kBAAI,KAAK,MAAL,EAAJ,EAAmB;AACjB,qBAAK,OAAL,CAAa;AACX,0BAAQ;AADG,iBAAb;AAGD,eAJD,MAKK;AACH,qBAAK,QAAL,CAAc,GAAd;AACD;;;;;AAGH;AACA;AACA;AACA;AACA;AACA;AACI,mBAAK,QAAL,CAAc,GAAd;AACJ;;;;;;;;;;;;;;;;;mBAKF,M,mBAAO,G,EAAI;AACP,YAAQ,GAAR;AACE,WAAK,iBAAL;AACI,eAAO,QAAP;AACJ,WAAK,gBAAL;AACI,eAAO,WAAP;AAJN;AAMH,G",
    "file": "../../../src/home/controller/login.js",
    "sourcesContent": [
        "'use strict';\n\nimport Base from './base.js';\nimport revalidate from 'revalidator'\n\nexport default class extends Base {\n  /**\n   * index action\n   * @return {Promise} []\n   */\n  async indexAction() {\n    let isLogin = await this.isLogin();\n\n    if (isLogin) {\n      return this.redirect('/');\n    }\n\n    return this.display(this.templateFile);\n  }\n\n  async loginAction() {\n    let isLogin = await this.isLogin();\n    if (!isLogin) {\n      let userName = this.post('userName');\n      let password = this.post('password');\n      let validate = revalidate.validate({\n        userName: userName,\n        password: password\n      }, {\n        properties: {\n          userName: {\n            required: true,\n            pattern: /^[A-Za-z0-9]+$/,\n            type: 'string',\n            description: '用户名错误'\n          },\n          password: {\n            required: true,\n            pattern: /^.*[^\\s]+.*$/,\n            type: 'string',\n            description: '密码错误'\n          }\n        }\n      });\n\n      if (!validate.valid) {\n        return this.fail('PASSWORD_ERROR');\n      }\n\n      let ip = this.ip();\n      let result = await this.model('user').login(userName, password, ip);\n\n      if (typeof result === 'string') {\n        return this.fail(getMsg(result));\n      }\n\n      await this.session('userInfo', result);\n        this.success({\n          status: 'ok'\n        });\n    }\n    else {\n        this.success({\n          status: 'ok'\n        });\n    }\n  }\n\n  async logoutAction () {\n    let isLogin = await this.isLogin();\n\n    if (isLogin) {\n      await this.session('userInfo', null);\n\n      if (this.isAjax()) {\n        this.success({\n          status: 'ok'\n        })\n      }\n      else {\n        this.redirect('/');\n      }\n    }\n    else {\n    //   if (this.isAjax()) {\n    //     this.success({\n    //       status: 'ok'\n    //     })\n    //   }\n    //   else {\n        this.redirect('/');\n    //   }\n    }\n  }\n\n\n  getMsg(msg){\n      switch (msg) {\n        case 'USER_NOT_EXIST]':\n            return '用户不存在!';\n        case 'PASSWORD_ERROR':\n            return '用户名或密码错误!';\n      }\n  }\n}\n"
    ]
}