{
    "version": 3,
    "sources": [
        "../../../src/home/controller/login.js"
    ],
    "names": [],
    "mappings": "AAAA;;;;;;;;;;;;;;;;;;;;;;;;AAEA;;;;AACA;;;;;;;;;;;;;;AAGE;;;;mBAIM,W;;;;;;;;qBACgB,KAAK,OAAL,E;;;AAAhB,qB;;mBAEA,O;;;;;+CACK,KAAK,QAAL,CAAc,GAAd,C;;;+CAGF,KAAK,OAAL,CAAa,KAAK,YAAlB,C;;;;;;;;;;;;;;;;;mBAGH,U;;;;;;;;qBACgB,KAAK,OAAL,E;;;AAAhB,qB;;kBAEC,O;;;;;AACC,mB,GAAQ,KAAK,IAAL,CAAU,OAAV,C;AACR,sB,GAAW,KAAK,IAAL,CAAU,UAAV,C;AAEX,sB,GAAW,sBAAW,QAAX,CAAoB;AACjC,uBAAO,KAD0B;AAEjC,0BAAU;AAFuB,eAApB,EAGZ;AACD,4BAAY;AACV,yBAAO;AACL,8BAAU,IADL;AAEL,4BAAQ,OAFH;AAGL,0BAAM,QAHD;AAIL,iCAAa;AAJR,mBADG;AAOV,4BAAU;AACR,8BAAU,IADF;AAER,6BAAS,UAFD;AAGR,0BAAM,QAHE;AAIR,iCAAa;AAJL;AAPA;AADX,eAHY,C;;kBAoBV,SAAS,K;;;;;gDACL,KAAK,IAAL,CAAU,gBAAV,C;;;AAGL,gB,GAAK,KAAK,EAAL,E;;qBACU,KAAK,KAAL,CAAW,YAAX,EAAyB,MAAzB,CAAgC,KAAhC,EAAuC,QAAvC,EAAiD,EAAjD,C;;;AAAf,oB;;oBAEA,OAAO,MAAP,KAAkB,Q;;;;;gDACb,KAAK,IAAL,CAAU,MAAV,C;;;;qBAGH,KAAK,OAAL,CAAa,UAAb,EAAyB,MAAzB,C;;;;AAEN,kBAAI,KAAK,MAAL,EAAJ,EAAmB;AACjB,qBAAK,OAAL,CAAa;AACX,0BAAQ;AADG,iBAAb;AAGD,eAJD,MAKK;AACH,qBAAK,QAAL,CAAc,GAAd;AACD;;;;;AAGD,kBAAI,KAAK,MAAL,EAAJ,EAAmB;AACjB,qBAAK,OAAL,CAAa;AACX,0BAAQ;AADG,iBAAb;AAGD,eAJD,MAKK;AACH,qBAAK,QAAL,CAAc,GAAd;AACD;;;;;;;;;;;;;;;;;mBAIC,Y;;;;;;;;qBACgB,KAAK,OAAL,E;;;AAAhB,qB;;mBAEA,O;;;;;;qBACI,KAAK,OAAL,CAAa,UAAb,EAAyB,IAAzB,C;;;;AAEN,kBAAI,KAAK,MAAL,EAAJ,EAAmB;AACjB,qBAAK,OAAL,CAAa;AACX,0BAAQ;AADG,iBAAb;AAGD,eAJD,MAKK;AACH,qBAAK,QAAL,CAAc,GAAd;AACD;;;;;AAGD,kBAAI,KAAK,MAAL,EAAJ,EAAmB;AACjB,qBAAK,OAAL,CAAa;AACX,0BAAQ;AADG,iBAAb;AAGD,eAJD,MAKK;AACH,qBAAK,QAAL,CAAc,GAAd;AACD",
    "file": "../../../src/home/controller/login.js",
    "sourcesContent": [
        "'use strict';\n\nimport Base from './base.js';\nimport revalidate from 'revalidator'\n\nexport default class extends Base {\n  /**\n   * index action\n   * @return {Promise} []\n   */\n  async indexAction() {\n    let isLogin = await this.isLogin();\n\n    if (isLogin) {\n      return this.redirect('/');\n    }\n\n    return this.display(this.templateFile);\n  }\n\n  async mainAction() {\n    let isLogin = await this.isLogin();\n\n    if (!isLogin) {\n      let email = this.post('email');\n      let password = this.post('password');\n\n      let validate = revalidate.validate({\n        email: email,\n        password: password\n      }, {\n        properties: {\n          email: {\n            required: true,\n            format: 'email',\n            type: 'string',\n            description: '用户名错误'\n          },\n          password: {\n            required: true,\n            pattern: /\\w{2,10}/,\n            type: 'string',\n            description: '密码错误'\n          }\n        }\n      });\n\n      if (!validate.valid) {\n        return this.fail('PASSWORD_ERROR');\n      }\n\n      let ip = this.ip();\n      let result = await this.model('admin/user').signin(email, password, ip);\n\n      if (typeof result === 'string') {\n        return this.fail(result);\n      }\n\n      await this.session('userInfo', result);\n\n      if (this.isAjax()) {\n        this.success({\n          status: 'ok'\n        });\n      }\n      else {\n        this.redirect('/');\n      }\n    }\n    else {\n      if (this.isAjax()) {\n        this.success({\n          status: 'ok'\n        });\n      }\n      else {\n        this.redirect('/');\n      }\n    }\n  }\n\n  async logoutAction () {\n    let isLogin = await this.isLogin();\n\n    if (isLogin) {\n      await this.session('userInfo', null);\n\n      if (this.isAjax()) {\n        this.success({\n          status: 'ok'\n        })\n      }\n      else {\n        this.redirect('/');\n      }\n    }\n    else {\n      if (this.isAjax()) {\n        this.success({\n          status: 'ok'\n        })\n      }\n      else {\n        this.redirect('/');\n      }\n    }\n  }\n}\n"
    ]
}